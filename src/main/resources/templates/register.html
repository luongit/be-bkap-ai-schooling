<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký tài khoản</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f2f5;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .container {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            width: 400px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: border 0.3s;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        input,
        select,
        button {
            width: 100%;
            padding: 10px 10px 10px 35px;
            margin-top: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            font-size: 14px;
            position: relative;
        }

        .input-icon {
            position: absolute;
            margin-left: 10px;
            margin-top: 12px;
            color: #888;
        }

        .role-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: bold;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid transparent;
            cursor: pointer;
            margin-top: 10px;
            transition: 0.3s;
        }

        .role-btn.student {
            background: #a8d0ff;
            color: #007bff;
        }

        .role-btn.student:hover {
            background: #007bff;
            color: white;
        }

        .role-btn.parent {
            background: #ffd1b3;
            color: #ff7f50;
        }

        .role-btn.parent:hover {
            background: #ff7f50;
            color: white;
        }

        .btn-back {
            background: #6c757d;
            color: white;
            border: none;
        }

        .btn-back:hover {
            background: #5a6268;
        }

        .btn-submit.student {
            background: #007bff;
            color: white;
            border: none;
        }

        .btn-submit.student:hover {
            background: #0056b3;
        }

        .btn-submit.parent {
            background: #ff7f50;
            color: white;
            border: none;
        }

        .btn-submit.parent:hover {
            background: #e67340;
        }

        .error {
            color: red;
            font-size: 13px;
            margin-top: 5px;
        }

        .success {
            color: green;
            font-size: 14px;
            margin-top: 5px;
        }

        .input-wrapper {
            position: relative;
        }
    </style>
</head>

<body>

    <div class="container" id="formContainer">
        <div id="step1">
            <h2>Chọn vai trò của bạn</h2>
            <button class="role-btn student" onclick="selectRole('student')"><i class="fas fa-user-graduate"></i> Học
                sinh</button>
            <button class="role-btn parent" onclick="selectRole('parent')"><i class="fas fa-user"></i> Phụ
                huynh</button>
        </div>

        <div id="step2" style="display:none;">
            <h2 id="formTitle"></h2>

            <div id="studentForm" style="display:none;">
                <div class="input-wrapper"><i class="fas fa-user input-icon"></i><input type="text" id="sUsername"
                        placeholder="Tên đăng nhập">
                    <div id="sUsernameErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-id-card input-icon"></i><input type="text" id="sFullName"
                        placeholder="Họ và tên">
                    <div id="sFullNameErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-calendar input-icon"></i><input type="date" id="sBirthdate"
                        placeholder="Ngày sinh">
                    <div id="sBirthdateErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-envelope input-icon"></i><input type="email" id="sEmail"
                        placeholder="Email">
                    <div id="sEmailErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-phone input-icon"></i><input type="text" id="sPhone"
                        placeholder="Số điện thoại">
                    <div id="sPhoneErr" class="error"></div>
                </div>
            </div>

            <div id="parentForm" style="display:none;">
                <div class="input-wrapper"><i class="fas fa-user input-icon"></i><input type="text" id="pUsername"
                        placeholder="Tên đăng nhập">
                    <div id="pUsernameErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-id-card input-icon"></i><input type="text" id="pFullName"
                        placeholder="Họ và tên">
                    <div id="pFullNameErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-map-marker-alt input-icon"></i><input type="text"
                        id="pAddress" placeholder="Địa chỉ">
                    <div id="pAddressErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-envelope input-icon"></i><input type="email" id="pEmail"
                        placeholder="Email">
                    <div id="pEmailErr" class="error"></div>
                </div>
                <div class="input-wrapper"><i class="fas fa-phone input-icon"></i><input type="text" id="pPhone"
                        placeholder="Số điện thoại">
                    <div id="pPhoneErr" class="error"></div>
                </div>
            </div>

            <div class="input-wrapper"><i class="fas fa-lock input-icon"></i><input type="password" id="password"
                    placeholder="Mật khẩu">
                <div id="passErr" class="error"></div>
            </div>
            <div class="input-wrapper"><i class="fas fa-lock input-icon"></i><input type="password" id="confirm"
                    placeholder="Nhập lại mật khẩu">
                <div id="confirmErr" class="error"></div>
            </div>

            <div style="display:flex; justify-content:space-between; margin-top:15px; gap:10px;">
                <button class="btn-back" onclick="goBack()"><i class="fas fa-arrow-left"></i> Quay lại</button>
                <button id="submitBtn" class="btn-submit student" onclick="register()"><i class="fas fa-user-plus"></i>
                    Đăng ký</button>
            </div>
            <p id="message"></p>
        </div>
    </div>

    <script>
        let selectedRole = null;

        function selectRole(role) {
            selectedRole = role;
            document.getElementById("studentForm").style.display = "none";
            document.getElementById("parentForm").style.display = "none";
            document.getElementById("step1").style.display = "none";
            document.getElementById("step2").style.display = "block";

            const container = document.getElementById("formContainer");
            const submitBtn = document.getElementById("submitBtn");

            if (role === "student") {
                document.getElementById("formTitle").innerText = "Đăng ký Học sinh";
                document.getElementById("studentForm").style.display = "block";
                container.style.borderTop = "5px solid #007bff";
                submitBtn.className = "btn-submit student";
            } else {
                document.getElementById("formTitle").innerText = "Đăng ký Phụ huynh";
                document.getElementById("parentForm").style.display = "block";
                container.style.borderTop = "5px solid #ff7f50";
                submitBtn.className = "btn-submit parent";
            }
            const errors = document.querySelectorAll(".error");
            errors.forEach(e => e.innerText = "");
            document.getElementById("message").innerText = "";
        }

        function goBack() {
            selectedRole = null;
            document.getElementById("step2").style.display = "none";
            document.getElementById("step1").style.display = "block";
            document.getElementById("studentForm").style.display = "none";
            document.getElementById("parentForm").style.display = "none";
            document.getElementById("message").innerText = "";
        }

        async function register() {
            const message = document.getElementById("message");
            message.innerText = "";
            message.className = "";

            let payload = {};
            let url = "";
            let password = document.getElementById("password").value;
            let confirm = document.getElementById("confirm").value;

            if (password !== confirm) {
                message.innerText = "⚠️ Mật khẩu nhập lại không khớp!";
                message.className = "error";
                return;
            }

            if (selectedRole === "student") {
                payload = {
                    username: document.getElementById("sUsername").value,
                    fullName: document.getElementById("sFullName").value,
                    birthdate: document.getElementById("sBirthdate").value,
                    email: document.getElementById("sEmail").value,
                    phone: document.getElementById("sPhone").value,
                    password
                };
                url = "https://bkapai.vn/api/auth/register/student";
            } else {
                payload = {
                    username: document.getElementById("pUsername").value,
                    name: document.getElementById("pFullName").value,
                    address: document.getElementById("pAddress").value,
                    email: document.getElementById("pEmail").value,
                    phone: document.getElementById("pPhone").value,
                    password
                };
                url = "https://bkapai.vn/api/auth/register/parent";
            }

            try {
                const res = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error(await res.text());
                message.innerText = "✅ Đăng ký thành công! Kiểm tra email để xác minh tài khoản.";
                message.className = "success";
                setTimeout(() => window.location.href = "/auth/login", 2000);
            } catch (err) {
                message.innerText = "❌ Lỗi đăng ký: " + err.message;
                message.className = "error";
                console.error(err);
            }
        }
    </script>
</body>

</html>